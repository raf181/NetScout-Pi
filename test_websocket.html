<!DOCTYPE html>
<html>
<head>
    <title>NetScout-Pi WebSocket Test</title>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const resultDiv = document.getElementById('result');
            
            function log(message) {
                const p = document.createElement('p');
                p.textContent = message;
                resultDiv.appendChild(p);
                console.log(message);
            }
            
            log('Connecting to server...');
            
            const socket = io('http://127.0.0.1:5000', {
                transports: ['polling', 'websocket'],
                reconnectionAttempts: 5,
                reconnectionDelay: 1000,
                timeout: 20000
            });
            
            socket.on('connect', function() {
                log('Connected to server!');
                
                // Execute the network scanner plugin
                const pluginId = 'network_scanner';
                const params = {
                    subnet: '192.168.10.0/24',
                    timeout: 0.5,
                    quick_scan: true
                };
                
                log(`Executing plugin ${pluginId} with params: ${JSON.stringify(params)}`);
                socket.emit('execute_plugin', {
                    plugin_id: pluginId,
                    params: params
                });
            });
            
            socket.on('disconnect', function() {
                log('Disconnected from server');
            });
            
            socket.on('connect_error', function(error) {
                log(`Connection error: ${error.message}`);
            });
            
            socket.on('system_update', function(data) {
                log(`System update received at: ${new Date(data.timestamp * 1000).toLocaleTimeString()}`);
            });
            
            socket.on('plugin_pending', function(data) {
                log(`Plugin execution pending: ${JSON.stringify(data)}`);
            });
            
            socket.on('plugin_result', function(data) {
                log(`Plugin result received for: ${data.plugin_id}`);
                log(`Result: ${JSON.stringify(data.result)}`);
            });
            
            socket.on('plugin_error', function(data) {
                log(`Plugin error: ${JSON.stringify(data)}`);
            });
        });
    </script>
</head>
<body>
    <h1>NetScout-Pi WebSocket Test</h1>
    <div id="result"></div>
</body>
</html>
